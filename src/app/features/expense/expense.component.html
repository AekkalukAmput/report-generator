<div class="wrapper">
  <div class="calendar">
    <full-calendar [options]="calendarOptions"></full-calendar>
  </div>

  <mat-card
    class="edit-card"
    appearance="outlined"
    [formGroup]="form"
    *ngIf="showForm()"
  >
    <mat-card-header>
      <span class="mat-card-title">{{
        editingId() ? "แก้ไขรายการ" : "เพิ่มรายการ"
      }}</span>
    </mat-card-header>
    <mat-card-content>
      <div class="flex">
        <div class="radio-card">
          <input
            type="radio"
            id="expense-type-income"
            formControlName="type"
            value="income"
            (change)="onTypeChange()"
          />
          <label class="income" for="expense-type-income">รายรับ</label>
        </div>
        <div class="radio-card">
          <input
            type="radio"
            id="expense-type-expense"
            formControlName="type"
            value="expense"
            (change)="onTypeChange()"
          />
          <label class="expense" for="expense-type-expense">รายจ่าย</label>
        </div>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>วันที่เริ่มโครงการ</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="startProjectDate"
          />
          <mat-datepicker-toggle
            matIconSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <mat-form-field>
          <mat-label>เวลา</mat-label>
          <input
            matInput
            aria-label="24hr"
            placeholder="24hr"
            readonly
            [ngxTimepicker]="fullTime"
            [format]="24"
            formControlName="time"
          />
          <ngx-material-timepicker
            #fullTime
            [cancelBtnTmpl]="customCancelButton"
            [confirmBtnTmpl]="customConfirmButton"
          ></ngx-material-timepicker>
          <ng-template #customCancelButton>
            <button class="time-btn cancel">ยกเลิก</button>
          </ng-template>
          <ng-template #customConfirmButton>
            <button class="time-btn confirm">ตั้งเวลา</button>
          </ng-template>
          <mat-icon matSuffix [ngxTimepicker]="fullTime">access_time</mat-icon>
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>หมวดหมู่</mat-label>
          <mat-select formControlName="category">
            <mat-optgroup
              *ngFor="let group of categoryDropdown"
              [label]="group.name"
            >
              <mat-option *ngFor="let item of group.items" [value]="item.value">
                {{ item.viewValue }}
              </mat-option>
            </mat-optgroup>
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>ค่าประเมินโครงการ (บาท)</mat-label>
          <input
            matInput
            type="text"
            formControlName="amount"
            min="0"
            step="0.01"
            numbersOnly
            currency
            [allowDecimals]="true"
          />
          <span class="prefix-amount" matTextPrefix>฿&nbsp;</span>
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>ประเภทลูกค้า</mat-label>
          <mat-select formControlName="customerType">
            <mat-option
              *ngFor="let item of customerTypeDdl"
              [value]="item.value"
            >
              {{ item.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>รหัสโครงการ</mat-label>
          <input matInput type="text" formControlName="orderNo" />
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>ชื่อเว็บไซต์</mat-label>
          <input matInput type="text" formControlName="websiteName" />
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>ที่อยู่</mat-label>
          <textarea matInput formControlName="address" rows="1"></textarea>
        </mat-form-field>
        <mat-form-field>
          <mat-label>เบอร์โทร</mat-label>
          <input matInput type="tel" formControlName="telNo" />
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>อัตราภาษีหัก ณ ที่จ่าย (%)</mat-label>
          <input
            matInput
            type="text"
            formControlName="withholdingTaxPercent"
            min="0"
            max="100"
            numbersOnly
            currency
            [allowDecimals]="true"
          />
          <span class="prefix-amount" matTextSuffix>&nbsp;%</span>
        </mat-form-field>
        <mat-form-field>
          <mat-label>ภาษีหัก ณ ที่จ่าย (บาท)</mat-label>
          <input
            matInput
            type="text"
            formControlName="withholdingTaxAmount"
            min="0"
            step="0.01"
            numbersOnly
            currency
            [allowDecimals]="true"
          />
          <span class="prefix-amount" matTextPrefix>฿&nbsp;</span>
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>อัตราค่าธรรมเนียมบริการ (%)</mat-label>
          <input
            matInput
            type="text"
            formControlName="withholdingTaxPercent"
            min="0"
            max="100"
            numbersOnly
            currency
            [allowDecimals]="true"
          />
          <span class="prefix-amount" matTextSuffix>&nbsp;%</span>
        </mat-form-field>
        <mat-form-field>
          <mat-label>ค่าธรรมเนียมบริการ (บาท)</mat-label>
          <input
            matInput
            type="text"
            formControlName="withholdingTaxAmount"
            min="0"
            step="0.01"
            numbersOnly
            currency
            [allowDecimals]="true"
          />
          <span class="prefix-amount" matTextPrefix>฿&nbsp;</span>
        </mat-form-field>
      </div>
      <div class="flex">
        <mat-form-field>
          <mat-label>หมายเหตุ</mat-label>
          <textarea matInput formControlName="note" rows="5"></textarea>
        </mat-form-field>
      </div>
      <div class="flex-header-items">
        <div>
          <span>รายการค่าใช้จ่าย</span>
        </div>
        <div>
          <button class="add-items-btn" (click)="onAddExpenseItems()">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
      <ng-container formArrayName="expenseItems">
        <ng-container
          *ngFor="let item of expenseItemArr.controls; let i = index"
        >
          <div class="flex" [formGroupName]="i">
            <mat-form-field>
              <mat-label>ชื่อค่าใช้จ่าย</mat-label>
              <input matInput type="text" formControlName="name" />
            </mat-form-field>
            <mat-form-field>
              <mat-label>จำนวนค่าใช้จ่าย (บาท)</mat-label>
              <input
                matInput
                type="text"
                formControlName="amount"
                min="0"
                step="0.01"
                numbersOnly
                currency
                [allowDecimals]="true"
              />
              <span class="prefix-amount" matTextPrefix>฿&nbsp;</span>
            </mat-form-field>
            <button class="delete-items-btn" (click)="onDeleteExpenseItems(i)">
              <mat-icon>delete_forever</mat-icon>
            </button>
          </div>
        </ng-container>
      </ng-container>
    </mat-card-content>
    <mat-card-actions class="action-buttons">
      <button class="btn-edit" type="button" (click)="submitForm()">
        {{ editingId() ? "บันทึก" : "เพิ่ม" }}
      </button>
      <button class="btn-cancel" type="button" (click)="cancelForm()">
        ยกเลิก
      </button>
      <button
        type="button"
        class="btn-delete"
        *ngIf="editingId()"
        (click)="deleteCurrent()"
      >
        ลบ
      </button>
    </mat-card-actions>
  </mat-card>
</div>
